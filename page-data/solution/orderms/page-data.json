{"componentChunkName":"component---src-pages-solution-orderms-index-mdx","path":"/solution/orderms/","result":{"pageContext":{"frontmatter":{"title":"Vaccine Order Management","description":"This microservice manage order for vaccine"},"relativePagePath":"/solution/orderms/index.mdx","titleType":"append","MdxNode":{"id":"39e4d6d6-82c5-546a-9eee-48c68a82c870","children":[],"parent":"8d6b2b86-339a-5bf2-b9e2-7b84e98d8630","internal":{"content":"---\ntitle: Vaccine Order Management\ndescription: This microservice manage order for vaccine\n---\n\nThis microservice manages vaccine orders for a world wide demand and distribution. This is an example of using [Quarkus](https://quarkus.io), microprofile [Reactive Messaging](https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/2/concepts.html), [Debezium outbox quarkus extension](https://debezium.io/documentation/reference/integrations/outbox.html) with Debezium [change data capture  for Postgresl](https://debezium.io/documentation/reference/connectors/postgresql.html) to Kafka. The database is Postgresql, the service uses Hibernate ORM with Panache. \n\nThe DevOps is supported by Git Action and then gitops repository.\n\n\n## Overview\n\nThis project implements a very simple event driven microservice to support the Create, Read, Update, of vaccine orders. This implementation highlights the following capabilities and patterns:\n\n* Quarkus reactive microservice using Microprofile 3.x - reactive messaging extension to consume Vaccine lot shipment plans\n* Postgresql with Hibernate ORM with [Quarkus Panache](https://quarkus.io/guides/hibernate-orm-panache)\n* Quarkus Debezium Outbox pattern to get create OrderEvents while writing to the main VaccineOrderEntity table\n* Integrate a Kafka Connector with Debezium change data capture table updates on the OrderEvents table.\n\nIn term of business scenario, a sale representative uses his mobile device or web browser to enter information about a vaccine order to be shipped to a given country or a province within a country at given date for a given quantity: \n\n ![](./images/order-ui.png)\n\nThe user interface is for demonstration purpose only, and illustrates some standard Vuejs / vuetify components. \n\nThe following diagram presents the simple context view of the service deployed on OpenShift, integrated with Kafka, Change data capture and the [Vaccine order reefer optimization service](/solution/orderms/voro-solution/). The integration with this component is using pub/sub via Kafka topics. The integration with Blockchain is not done yet, but it can be seen as the source of truth for the business companies participating to then end to end delivery.  \n\n ![Deployment view](./images/vaccine-order-1.png)\n\n\nThe component writes to the database all the orders received, but also produces records to Kafka via the Outbox pattern and Debezium change data capture.\n\nThe Quarkus Debezium outbox pattern is described in [this note](https://debezium.io/documentation/reference/integrations/outbox.html). The configuration used is in the `application.properties`:\n\n```\nquarkus.debezium-outbox.id.name=aggregateid\nquarkus.debezium-outbox.id.column-definition=\"DECIMAL NOT NULL\"\nquarkus.index-dependency.outbox.group-id=io.debezium\nquarkus.debezium-outbox.aggregate-id.name=aggregateid\nquarkus.debezium-outbox.aggregate-id.column-definition=\"DECIMAL NOT NULL\"\nquarkus.index-dependency.outbox.artifact-id=debezium-quarkus-outbox\nquarkus.debezium-outbox.table-name=orderevents\n```\n\nAnother view could be a pods view of the solution to deploy. The Debezium change data capture is a Kafka connector.\n\n ![Pods view](./images/pods-map.png)\n\n**Github repository:** [Vaccine-order-mgr-pg](https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg)\n\n\n**Kafka topics produced to:** vaccine.public.orderevents\n**Kafka topics consumed from :** vaccine.shipment.plans\n\n**Events produced:**\n\nWe will simplify the process and aggregate in the following event types:\n\n* orderCreated\n* orderUpdated\n\n\nThe following environment variables are used by the application, and configured via the [src/main/resources/application.properties](https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg/blob/master/src/main/resources/application.properties).\n\n  ```properties\n  quarkus.openshift.env.configmaps=vaccine-order-ms-cm\n  quarkus.openshift.env.secrets=vaccine-order-secrets\n  quarkus.openshift.env.mapping.KAFKA_SSL_TRUSTSTORE_PASSWORD.from-secret=eda.dev-cluster-ca-cert\n  quarkus.openshift.env.mapping.KAFKA_SSL_TRUSTSTORE_PASSWORD.with-key=ca.password\n  quarkus.openshift.mounts.es-cert.path=/deployments/certs/server\n  quarkus.openshift.secret-volumes.es-cert.secret-name=eda-gse-cluster-ca-cert\n  ```\n\n## Build and deploy to OpenShift\n\nThis microservice is built using maven and Quarkus extensions. We have already pushed the last version of this service on dockerhub, if you do not want to build it. \n\nTo build and run locally see the [repository main readme](https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg) as we have different docker-compose files to run in demonstration mode or in development mode.\n\nTo build and deploy to OpenShift, you can follow the step by step instructions in [this scenario](/use-cases/order/).\n\nAs an alternate you can use the different scripts from the `vaccine-order-mgr-pg` project:\n\n* Clone the source git repository: `git clone https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg`\n* Set some environment variables in `./src/main/scripts/setenv.sh` script.\n* Deploy postgresql\n\n  ```shell\n  cd ./src/main/scripts/\n  deployPostgresql.sh\n  ```\n\nIn this section we address how to use OpenShift Source to Image to build and deploy the application to OpenShift. The application is using environment variables to access to user, password, URLs to access Postgres and Kafka. We are using Event Streams deployed in Cloud Pak for Integration, but it could work the same with Strimzi. \n\nAs an example we created the OpenShift project called \"vaccine\" with a command: `oc new-project vaccine`.\n\n### Deploy the application\n\nSee readme file in project repository and the [order optimization use case description](/use-cases/order/)\n\nThe application uses Quarkus OpenShift extension to create yaml files for OpenShift and deploy the application using source to image capability of OpenShift:\n\n ```shell\n source .env\n ./mvnw clean package -Dui.deps -Dui.dev -Dquarkus.kubernetes.deploy=true -DskipTests\n ```\n\nThe `-Dui.deps -Dui.dev` arguments are used to prepare and build the vue.js app from the `ui` folder. The packaging build a runner jar and push it to the private image registry in OpenShift.\n\n\nIt can take some seconds to build and deploy: `oc get pods -w` lets you see the build pods and the running app once the build is done. As we set properties to expose the application, an OpenShift route was created. \n\n* Be sure to get the Order Microservice URL to access the user interface, using `oc get routes` on the project. Using your web browser, pointing to this address you should get the UI:\n\n ![](./images/ui-home.png)\n\n\n","type":"Mdx","contentDigest":"ccbdc56f96e2622a4d168847a5627278","counter":350,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Vaccine Order Management","description":"This microservice manage order for vaccine"},"exports":{},"rawBody":"---\ntitle: Vaccine Order Management\ndescription: This microservice manage order for vaccine\n---\n\nThis microservice manages vaccine orders for a world wide demand and distribution. This is an example of using [Quarkus](https://quarkus.io), microprofile [Reactive Messaging](https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/2/concepts.html), [Debezium outbox quarkus extension](https://debezium.io/documentation/reference/integrations/outbox.html) with Debezium [change data capture  for Postgresl](https://debezium.io/documentation/reference/connectors/postgresql.html) to Kafka. The database is Postgresql, the service uses Hibernate ORM with Panache. \n\nThe DevOps is supported by Git Action and then gitops repository.\n\n\n## Overview\n\nThis project implements a very simple event driven microservice to support the Create, Read, Update, of vaccine orders. This implementation highlights the following capabilities and patterns:\n\n* Quarkus reactive microservice using Microprofile 3.x - reactive messaging extension to consume Vaccine lot shipment plans\n* Postgresql with Hibernate ORM with [Quarkus Panache](https://quarkus.io/guides/hibernate-orm-panache)\n* Quarkus Debezium Outbox pattern to get create OrderEvents while writing to the main VaccineOrderEntity table\n* Integrate a Kafka Connector with Debezium change data capture table updates on the OrderEvents table.\n\nIn term of business scenario, a sale representative uses his mobile device or web browser to enter information about a vaccine order to be shipped to a given country or a province within a country at given date for a given quantity: \n\n ![](./images/order-ui.png)\n\nThe user interface is for demonstration purpose only, and illustrates some standard Vuejs / vuetify components. \n\nThe following diagram presents the simple context view of the service deployed on OpenShift, integrated with Kafka, Change data capture and the [Vaccine order reefer optimization service](/solution/orderms/voro-solution/). The integration with this component is using pub/sub via Kafka topics. The integration with Blockchain is not done yet, but it can be seen as the source of truth for the business companies participating to then end to end delivery.  \n\n ![Deployment view](./images/vaccine-order-1.png)\n\n\nThe component writes to the database all the orders received, but also produces records to Kafka via the Outbox pattern and Debezium change data capture.\n\nThe Quarkus Debezium outbox pattern is described in [this note](https://debezium.io/documentation/reference/integrations/outbox.html). The configuration used is in the `application.properties`:\n\n```\nquarkus.debezium-outbox.id.name=aggregateid\nquarkus.debezium-outbox.id.column-definition=\"DECIMAL NOT NULL\"\nquarkus.index-dependency.outbox.group-id=io.debezium\nquarkus.debezium-outbox.aggregate-id.name=aggregateid\nquarkus.debezium-outbox.aggregate-id.column-definition=\"DECIMAL NOT NULL\"\nquarkus.index-dependency.outbox.artifact-id=debezium-quarkus-outbox\nquarkus.debezium-outbox.table-name=orderevents\n```\n\nAnother view could be a pods view of the solution to deploy. The Debezium change data capture is a Kafka connector.\n\n ![Pods view](./images/pods-map.png)\n\n**Github repository:** [Vaccine-order-mgr-pg](https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg)\n\n\n**Kafka topics produced to:** vaccine.public.orderevents\n**Kafka topics consumed from :** vaccine.shipment.plans\n\n**Events produced:**\n\nWe will simplify the process and aggregate in the following event types:\n\n* orderCreated\n* orderUpdated\n\n\nThe following environment variables are used by the application, and configured via the [src/main/resources/application.properties](https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg/blob/master/src/main/resources/application.properties).\n\n  ```properties\n  quarkus.openshift.env.configmaps=vaccine-order-ms-cm\n  quarkus.openshift.env.secrets=vaccine-order-secrets\n  quarkus.openshift.env.mapping.KAFKA_SSL_TRUSTSTORE_PASSWORD.from-secret=eda.dev-cluster-ca-cert\n  quarkus.openshift.env.mapping.KAFKA_SSL_TRUSTSTORE_PASSWORD.with-key=ca.password\n  quarkus.openshift.mounts.es-cert.path=/deployments/certs/server\n  quarkus.openshift.secret-volumes.es-cert.secret-name=eda-gse-cluster-ca-cert\n  ```\n\n## Build and deploy to OpenShift\n\nThis microservice is built using maven and Quarkus extensions. We have already pushed the last version of this service on dockerhub, if you do not want to build it. \n\nTo build and run locally see the [repository main readme](https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg) as we have different docker-compose files to run in demonstration mode or in development mode.\n\nTo build and deploy to OpenShift, you can follow the step by step instructions in [this scenario](/use-cases/order/).\n\nAs an alternate you can use the different scripts from the `vaccine-order-mgr-pg` project:\n\n* Clone the source git repository: `git clone https://github.com/ibm-cloud-architecture/vaccine-order-mgr-pg`\n* Set some environment variables in `./src/main/scripts/setenv.sh` script.\n* Deploy postgresql\n\n  ```shell\n  cd ./src/main/scripts/\n  deployPostgresql.sh\n  ```\n\nIn this section we address how to use OpenShift Source to Image to build and deploy the application to OpenShift. The application is using environment variables to access to user, password, URLs to access Postgres and Kafka. We are using Event Streams deployed in Cloud Pak for Integration, but it could work the same with Strimzi. \n\nAs an example we created the OpenShift project called \"vaccine\" with a command: `oc new-project vaccine`.\n\n### Deploy the application\n\nSee readme file in project repository and the [order optimization use case description](/use-cases/order/)\n\nThe application uses Quarkus OpenShift extension to create yaml files for OpenShift and deploy the application using source to image capability of OpenShift:\n\n ```shell\n source .env\n ./mvnw clean package -Dui.deps -Dui.dev -Dquarkus.kubernetes.deploy=true -DskipTests\n ```\n\nThe `-Dui.deps -Dui.dev` arguments are used to prepare and build the vue.js app from the `ui` folder. The packaging build a runner jar and push it to the private image registry in OpenShift.\n\n\nIt can take some seconds to build and deploy: `oc get pods -w` lets you see the build pods and the running app once the build is done. As we set properties to expose the application, an OpenShift route was created. \n\n* Be sure to get the Order Microservice URL to access the user interface, using `oc get routes` on the project. Using your web browser, pointing to this address you should get the UI:\n\n ![](./images/ui-home.png)\n\n\n","fileAbsolutePath":"/home/runner/work/vaccine-solution-main/vaccine-solution-main/docs/src/pages/solution/orderms/index.mdx"}}},"staticQueryHashes":["1054721580","1054721580","1364590287","2102389209","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}